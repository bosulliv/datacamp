---
title: "R Notebook"
output: html_notebook
---

# Chapter 3

```{r}
# prep data
x <- arima.sim(model = list(order = c(1, 1, 0), ar = .9), n = 200)

# Plot x
plot(x)

# Plot the P/ACF pair of x
plot(acf2(x))

# Plot the differenced data
plot(diff(x))

# Plot the P/ACF pair of the differenced data
plot(acf2(diff(x)))
```


```{r}
# prep data
start_spot <- 2
yt <- arima.sim(model = list(order = c(2, 0, 0), ar = c(1.5, -0.75)), n = 250, mean = 0.08) + 1
x <- start_spot + cumsum(yt)
x <- ts(x)
x
y <- diff(x)
plot(x)

# Plot sample P/ACF of differenced data and determine model
plot(acf2(diff(x)))

# Estimate parameters and examine output
sarima(x, p = 2, d = 1, q = 0)
```

```{r}
# data prep
globtemp

# Plot the sample P/ACF pair of the differenced data 
plot(acf2(diff(globtemp)))

# Fit an ARIMA(1,1,1) model to globtemp
s1 <- sarima(globtemp, p = 1, d = 1, q = 1)

# Fit an ARIMA(0,1,2) model to globtemp. Which model is better?
s2 <- sarima(globtemp, p = 0, d = 1, q = 2)

# test
s1$BIC > s2$BIC
s1$AIC > s2$AIC
```

```{r}
# prep data
x <- c(
  -0.07509997, 0.1473329, 1.811237, 4.893105, 7.029199, 8.135151, 9.022732, 10.39038, 11.99892, 11.45268, 11.27072, 12.53118, 12.19629, 10.79773, 12.06506, 13.58847, 12.48021, 11.70905, 10.93563, 12.36635, 14.3876, 14.21292, 13.56607, 12.91554, 13.41544, 14.91055, 16.25522, 16.73926, 17.14471, 18.05555, 19.73764, 22.54072, 24.73666, 24.84129, 24.24884, 24.29674, 24.23079, 23.89016, 23.70272, 23.11904, 22.73352, 22.96572, 23.88085, 24.43447, 24.24659, 23.42572, 20.85138, 19.49984, 19.93982, 20.2972, 20.72619, 20.19643, 17.50816, 15.99066, 15.42638, 14.11238, 14.4446, 16.34021, 17.57698, 19.45574, 21.64712, 22.18943, 21.06414, 20.05407, 21.01692, 22.37581, 21.96964, 20.01095, 19.23893, 19.28609, 20.46375, 21.59976, 18.99071, 15.92179, 16.75102, 17.32347, 15.81709, 16.90224, 17.22956, 16.28379, 17.80277, 19.72931, 20.48881, 21.4197, 21.15155, 21.11375, 23.02368, 24.21102, 23.15217, 22.35389, 23.31072, 23.10709, 21.67626, 21.74437, 23.00203, 24.76462, 26.06393, 25.97866, 27.83549, 30.58865, 30.1021, 29.41028, 29.88468, 29.59955, 29.57719, 30.41561, 30.26647, 28.70989, 27.67805, 25.95676, 24.91561, 24.8254, 25.69521, 27.64104, 28.89811, 29.2489, 30.92971, 32.5278, 31.59716, 32.36453, 33.21057, 34.15946, 34.42305, 33.86417, 34.7263, 35.27137, 36.66186, 38.53221, 38.76345, 39.16581, 40.71821, 40.89101, 39.73629, 40.15942, 40.65494, 40.36543, 40.5468, 40.70075, 40.34079, 39.39425, 37.25709, 36.90956, 37.03381, 35.85724, 35.43782, 36.65706, 38.43275, 40.4212, 42.06166, 42.17011, 42.98754, 45.42345, 45.79482, 44.39092, 42.80911, 39.80392, 37.17847, 36.82376, 36.88165, 37.62871, 39.37209, 39.77848, 39.31118, 36.6673, 33.27396, 31.30974, 30.9826, 30.46202, 30.68706, 29.67286, 28.57213, 30.02259, 31.06489, 32.93865, 34.88144, 34.89454, 35.02336, 34.68936, 33.04019, 34.22735, 37.58083, 39.23343, 37.9677, 36.64509, 36.77561, 34.47778, 31.60037, 29.14285, 28.61, 29.93078, 28.56808, 27.31207, 28.07949, 29.26282, 30.99141, 32.9232, 34.3216, 35.48337, 37.66383, 39.10198, 39.29359, 40.94476, 42.36068, 43.51721, 44.45134, 43.90766, 43.36476, 44.25657, 44.02957, 43.34376, 43.43302, 46.23473, 47.80192, 46.50198, 46.57949, 49.11359, 50.92801, 51.51141, 50.08022, 48.67482, 50.24348, 51.87713, 52.62984, 52.83524, 52.94607, 50.40087, 48.55224, 50.34459, 53.23336, 54.3444, 55.41208, 55.91477, 53.74992, 53.91317, 54.72848, 54.42538, 53.54421, 54.14583, 56.72797, 58.40621, 58.95894, 58.35149, 58.91289, 58.36791, 56.14504, 54.13727, 54.01956, 54.29608, 52.78404, 51.71499
)

# Plot sample P/ACF pair of the differenced data
plot(acf2(diff(x)))

# Fit the first model, compare parameters, check diagnostics: 0,1,1
s1 <- sarima(x, p = 0, d = 1, q = 1)

# Fit the second model and compare fit: 0,1,2
s2 <- sarima(x, p = 0, d = 1, q = 2)

s1$ttable
s2$ttable
```

```{r}
# data prep


# Fit ARIMA(0,1,2) to globtemp and check diagnostics  
s1 <- sarima(globtemp, p=0, d=1, q=2)

# Fit ARIMA(1,1,1) to globtemp and check diagnostics
s1 <- sarima(globtemp, p=1, d=1, q=1)

# Which is the better model?
"ARIMA(1,1,1)"

# check 
s1$ttable
s2$ttable
s1$BIC < s2$BIC
s1$AIC < s2$AIC
```

```{r}
# homework- build a function which returns the best model, given a list of models
# I took this approach - give a list of models, and it returns the index in the list
# of the best one
best_sarima <- function (x) {
  aic <- vapply(x, `[[`, "AIC", FUN.VALUE = 1)
  idx <- which(aic == min(aic))
  return(idx)
}

best_sarima(list(s1, s2))
```


```{r}
# prep data
x = c(
  1.475311, 3.060689, 6.530352, 9.844334, 15.73487, 20.7976, 24.6347, 27.32219, 28.79349, 30.39959, 31.67223, 32.20941, 33.2546, 35.52952, 35.87038, 35.64995, 35.76643, 34.50923, 32.4383, 30.80369, 30.91287, 29.8453, 28.66723, 27.55477, 26.96244, 26.6492, 28.01822, 30.80423, 34.62453, 38.36319, 41.74534, 46.05945, 51.43147, 56.77822, 61.52862, 65.51008, 69.05355, 70.33171, 72.31792, 73.34069, 74.75577, 77.63218, 78.61792, 78.41852, 78.41226, 80.36175, 82.77113, 84.24048, 86.61857, 89.24072, 93.31761, 95.56649, 98.50921, 102.0855, 105.0167, 107.2421, 107.9455, 107.9477, 107.5541, 106.4752, 105.5175, 104.3567, 104.2963, 103.9462, 102.8959, 102.2181, 102.7964, 102.7259, 101.7586, 101.336, 100.97, 101.8156, 101.7364, 100.882, 100.9739, 101.7838, 101.4095, 102.4861, 102.9712, 103.1049, 103.8861, 104.5588, 104.3486, 104.1519, 105.4606, 106.4562, 106.6113, 106.8274, 108.5872, 110.0332, 110.9926, 113.209, 113.3967, 113.5748, 113.9454, 113.7855, 113.4733, 112.9393, 112.2225, 110.2973
)

# Plot P/ACF pair of differenced data 
plot(acf2(diff(x)))

# Fit model - check t-table and diagnostics
sarima(x, p = 1, d = 1, q = 0)

# Forecast the data 20 time periods ahead
sarima.for(x, n.ahead = 20, p = 1, d = 1, q = 0) 
lines(y)  

```

```{r}
# Fit an ARIMA(0,1,2) to globtemp and check the fit
sarima(globtemp, p = 0, d = 1, q = 2)

# Forecast data 35 years into the future
sarima.for(globtemp, n.ahead = 35, p = 0, d = 1, q = 2)
```



















---
title: "R Notebook"
output: html_notebook
---

# Chatper 4

```{r}
# prep data
x <- c(
  -3.063144, -1.997322, -3.924965, 5.370375, 7.470366, 0.5023283, 2.477005, -10.09301, -3.462141, 1.834898, 3.801548, 1.852905, -1.945174, -1.881419, -4.782832, 4.361262, 7.158924, 2.69851, 0.2368272, -9.932837, -3.405602, 0.7184507, 2.713033, 2.30938, -1.308048, -0.5726911, -5.370281, 3.052878, 7.749064, 3.925613, -0.3544207, -10.32639, -1.302154, 1.796318, 1.536934, 4.595858, -0.9381067, -0.7532674, -5.059405, 3.345997, 7.318699, 2.801531, 0.2364877, -9.540996, -1.466351, 3.829212, 1.562049, 3.934206, -0.794632, -0.3196859, -4.606889, 2.946613, 6.478534, 0.4026539, 0.4127896, -8.069256, -2.51178, 4.104573, 0.4488127, 1.273895, -0.5608672, -0.3457005, -2.93266, 2.525399, 5.876125, -1.374132, -0.833082, -8.192817, -1.464591, 5.501663, 0.1453638, 1.336497, -0.09721245, 0.8928477, -2.446507, 2.868509, 4.521935, -1.133357, -0.960571, -8.429679, -1.32448, 6.856471, 0.5606003, 1.842076, -0.4535468, 2.785816, -4.908323, 2.909479, 3.650131, -0.6813016, -1.064226, -6.47489, 0.3131536, 6.849138, 2.604786, 3.128977, -0.6265568, 2.904311, -6.023314, 1.975524, 3.744754, -1.207379, -0.2314606, -5.568748, 0.1163605, 4.87373, 3.748522, 4.21619, -0.801218, 2.668983, -3.866492, 3.525886, 3.609954, -0.2981658, -0.3655162, -5.148062, -1.464896, 2.259236, 3.214319, 4.788643, -0.7837454, 2.85818, -3.764437, 3.884657, 2.725431, 1.296941, -1.534257, -4.080957, -2.080637, -0.05021453, 1.179968, 4.581612, -2.741524, 1.989871, -2.828257, 4.169201, 0.7530045, 2.189519, -1.838346, -2.821165, -4.066733, -1.379696, 0.9832596, 4.56122, -3.011425, 0.5685495, -3.254662, 2.011804, -0.3962811, 1.63028, -1.765963, -2.187435, -2.506999, -1.29555, 1.74474, 4.974877, -3.101749, 1.359998, -2.611303, -0.1090133, 1.387607, 1.727109, -2.49007, -3.813477, -1.957474, -0.5715488, 2.379163, 5.920026, -5.054109, 1.698033, -2.621439, -1.538767, 1.801567, 1.931716, -1.40558, -5.838663, -3.01082, -0.7901879, 2.080413, 4.143736, -6.071914, 2.374349, -2.65873, -2.097699, 0.721983, 2.443044, -1.122195, -5.979505, -4.849788, -0.7124501, 1.868301, 2.127443, -6.854423, 1.909945, -3.205179, -1.139475, 0.5809673, 1.526503, -2.050824, -6.724101, -4.612441, -1.235605, 0.5896358, 0.8280313, -7.434204, 0.6021173, -4.287728, -1.824737, -0.2418438, 0.1070124, -2.540931, -7.618251, -4.066032, 0.3231598, 0.1665995, 0.1449741, -6.404239, 0.5847683, -3.074733, -3.812052, -2.483783, 0.7830674, -2.511926, -7.770063, -4.389284, 2.426067, 0.6070704, 0.4702165, -5.933758, 1.550612, -1.288341, -3.312394, -3.321069, 2.478402, -1.35133, -10.6929, -5.37528, 3.161275, -0.4737236, 2.110268, -6.452898, 0.9985502, -0.4725182, -2.44178, -3.739766, 3.270586, -2.570283, -10.64441, -3.971929, 2.408217, 0.06779706, 3.374612
)

# Plot sample P/ACF to lag 60 and compare to the true values
acf2(x, max.lag = 60)

# Fit the seasonal model to x
sarima(x, p = 0, d = 0, q = 0, P = 1, D = 0, Q = 1, S = 12)
```

```{r}
# prep data
x <- c(-1.242584, -0.6800654, 1.356228, 0.8431298, -0.4088068, 1.061901, -1.080243, 3.001595, 0.8124837, -0.3884393, -1.788323, 2.320609, -3.264149, 0.8659682, -0.00402756, 0.2885234, 0.8551358, 1.444793, -1.084844, 2.425671, -2.200675, -1.013532, 0.1272422, 1.326061, -2.95798, 2.63476, -1.208744, 0.2876623, 0.02458591, 2.224506, -0.7921888, 2.57966, -2.439909, -1.961278, 1.732271, -0.620035, -1.062613, 1.147601, -0.5529481, 1.191904, -1.642274, 0.8361194, 1.021692, 0.8440071, 0.4071522, -1.239294, -0.0928417, -0.9175436, -0.5434908, 0.01722477, 0.2177952, 1.894545, -1.628252, 1.091603, 1.424572, -0.9616069, -1.407069, 0.5803224, 0.1281855, -0.5089995, -0.37988, 0.8861235, -1.134515, 2.318501, -1.19853, 2.700268, 0.3399238, -1.393284, -1.553495, 1.14939, 1.949613, -0.5625234, -1.746107, 2.439684, -1.448855, 0.3056529, 0.4947264, 2.169513, 1.035245, 0.1863908, 0.04350682, 0.9722664, -1.724176, 1.314489, -1.912277, 1.810016, 1.110647, -1.517452, 2.950448, -1.681907, 2.422461, -1.525514, 0.3720905, -0.5025125, -0.1601978, -1.419968, -0.8262, 1.201319, 1.764214, -1.758537, 3.391742, -0.8729135, 1.488777, -2.767515, 0.4421463, 0.1706344, -1.117461, -0.7565578, 0.755501, 0.9306695, -0.8323172, 1.028454, 1.175973, -0.2703058, 0.8184495, -2.096438, -0.2337238, 0.3099358, -1.017774, 2.883171, -1.119127, 0.2014008, -0.4953805, 1.506372, -0.6958206, 0.02091853, 0.4609106, -2.816884, 0.6650742, -0.7699126, 2.283441, 0.6351425, -2.875531, -0.2008196, 1.109496, 0.66602, 0.09576193, -0.7755916, -2.021893, 2.101421, -0.8612132, -1.659009, 3.324113, -0.4276972, 0.002466365, -0.06289277, 0.08099765, -0.03413247, -1.022142, 0.2473048, -2.832395, 4.966957, -2.348401, -1.963408, 2.966058, 0.3167187, 0.678206, -1.145504, -0.2786731, 1.632168, -3.308165, 1.182746, 0.875228, 1.941196, -1.4267, -1.035947, 1.195494, 1.425398, 1.126426, -3.35375, 1.02462, 0.9757758, -1.009612, -1.436923, 2.349048, -0.4515254, 0.2690278, -0.2447613, -1.107421, 2.442302, -0.5440831, -0.1136366, -0.1208313, 1.016872, -1.107302, -0.6785088, 0.3562774, -0.5354343, 0.5842286, 1.074678, -1.729858, 1.321085, -1.502897, 0.7968409, -0.7130145, 1.598621, -1.551223, 1.462205, -1.565678, -2.094075, 1.158968, 1.520268, 0.5276742, -0.4795178, 0.01969369, -0.3574592, 1.088236, -0.9355018, 2.707108, -0.05282827, -1.876361, -1.162397, 2.719218, -0.8180133, -0.350722, 0.4589365, 0.6500562, -0.7353266, 2.804976, -1.153057, 2.17094, -0.007462235, -0.5398278, -1.186119, 1.693939, 0.491211, -3.269851, 1.605138, -0.2562958, 0.2354129, 2.334252, 1.164025, -2.023788, -0.1742776, 1.587547, -3.0794, -1.285589, 2.67965, -2.624703, 0.2800321, -0.910474, 0.7892757, 1.677195, 1.2914, -2.935185, 0.5869793, 0.7828965, -0.7485495, -0.455095, 1.18127, -0.2213053, -1.712763)

# Plot sample P/ACF pair to lag 60 and compare to actual
plot(acf2(x, max.lag = 60))

# This looks 0,0,1 0,0,1 S = 12 
# i.e both components are MA, with yearly season

# Fit the seasonal model to x
sarima(x, p = 0, d = 0, q = 1, P = 0, D = 0, Q = 1, S = 12)

```


```{r}
# Plot unemp 
plot(unemp)

# Difference your data and plot it
d_unemp <- diff(unemp)
plot(d_unemp)

# Seasonally difference d_unemp and plot it
dd_unemp <- diff(d_unemp, lag = 12)
plot(dd_unemp)
```

```{r}
# Plot P/ACF pair of fully differenced data to lag 60
dd_unemp <- diff(diff(unemp), lag = 12)
plot(acf2(dd_unemp))

# Fit an appropriate model
sarima(unemp, p = 2, d = 1, q = 0, P = 0, D = 1, Q = 1, S = 12)
```

```{r}
# Plot differenced chicken
plot(chicken)
plot(diff(chicken))

# Plot P/ACF pair of differenced data to lag 60
plot(acf2(diff(chicken), max.lag = 60))

# Fit ARIMA(2,1,0) to chicken - not so good
sarima(chicken, p = 2, d = 1, q = 0)

# Fit SARIMA(2,1,0,1,0,0,12) to chicken - that works
sarima(chicken, p = 2, d = 1, q = 0, P = 1, D = 0, Q = 0, S = 12)

```

```{r}
# Plot P/ACF to lag 60 of differenced data
d_birth <- diff(birth)
plot(acf2(d_birth, max.lag = 60))

# Plot P/ACF to lag 60 of seasonal differenced data
dd_birth <- diff(d_birth, lag = 12)
plot(acf2(dd_birth, max.lag = 60))

# Fit SARIMA(0,1,1)x(0,1,1)_12. What happens?
s1 <- sarima(birth, p = 0, d = 1, q  =1, P = 0, D = 1, Q = 1, S = 12)

# Add AR term and conclude
s2 <- sarima(birth, p = 1, d = 1, q  =1, P = 0, D = 1, Q = 1, S = 12)
s3 <- sarima(birth, p = 1, d = 0, q  =1, P = 0, D = 1, Q = 1, S = 12)
s4 <- sarima(birth, p = 1, d = 1, q  =1, P = 0, D = 0, Q = 1, S = 12)
s4 <- sarima(birth, p = 1, d = 0, q  =1, P = 0, D = 0, Q = 1, S = 12)
best_sarima(list(s1, s2, s3, s4))
```

```{r}
# Fit your previous model to unemp and check the diagnostics
sarima(unemp, p = 2, d = 1, q = 0, P = 0, D = 1, Q = 1, S = 12)

# Forecast the data 3 years into the future
sarima.for(unemp, p = 2, d = 1, q = 0, P = 0, D = 1, Q = 1, S = 12, n.ahead = 36)
```

```{r}
# Fit the chicken model again and check diagnostics
sarima(chicken, p = 2, d = 1, q = 0, P = 1, D = 0, Q = 0, S = 12)

# Forecast the chicken data 5 years into the future
sarima.for(chicken, p = 2, d = 1, q = 0, P = 1, D = 0, Q = 0, S = 12, n.ahead = 60)
```




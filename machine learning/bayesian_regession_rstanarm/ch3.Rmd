---
title: "R Notebook"
output: html_notebook
---

```{r}
require(readr)
require(rstanarm)
require(broom)
```

```{r}
# download csv, and write to local disk...
songs <- read_csv('https://assets.datacamp.com/production/repositories/2199/datasets/3c921f85674c92085b3428c303b9364573a8bd4f/datacamp-spotify-data.csv')
write_csv(songs, './songs.csv')
songs <- read_csv('songs.csv')
```

```{r}
# data prep
lm_model <- lm(popularity ~ song_age, data=songs)
lm_summary <- summary(lm_model)
lm_summary
```

```{r}
# Print the R-squared from the linear model
lm_summary$r.squared

# Calulate sums of squares
ss_res <- var(residuals(lm_model))
ss_fit <- var(fitted(lm_model))

# Calculate the R-squared
1 - (ss_res / (ss_res + ss_fit))
```

```{r}
# data prep
stan_model <- stan_glm(popularity ~ song_age, data=songs)
summary(stan_model)
```

```{r}
# Save the variance of residulas
ss_res <- var(residuals(stan_model))

# Save the variance of fitted values
ss_fit <- var(fitted(stan_model))

# Calculate the R-squared
1 - (ss_res / (ss_res + ss_fit))
```

```{r}
# Calculate posterior predictive scores
predictions <- posterior_linpred(stan_model)

# Print a summary of the observed data
summary(songs$popularity)

# Print a summary of the 1st replication
summary(predictions[1,])

# Print a summary of the 10th replication
summary(predictions[10,])
```


